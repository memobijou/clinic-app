{% extends 'base.html' %}
{% load static %}

{% block horizontal_nav_title %}
    <h2>Terminplanung</h2>
{% endblock %}

{% block horizontal_nav_navigation %}
    <li><span>Terminplanung</span></li>
{% endblock %}


{% block content %}
    <div class="panel-body">
    <br/><br/>
        <div class="col-md-8 col-md-offset-2">
            <div class="text-center">
                <button class="btn btn-info ac" id="appointment_btn" data-toggle="collapse" data-target="#demo">Neuer Termin
                    <i class="fa fa-fw fa-chevron-down" id="collapse_arrow"></i>
                </button>
            </div>
            <div id="demo" class="collapse" style="padding-top:25px;">
                <div class="tabs">
                    <ul class="nav nav-tabs nav-justified">
                        <li class="active">
                            <a href="#popular10" data-toggle="tab" class="text-center"> Infobox</a>
                        </li>
                        <li>
                            <a href="#recent10" data-toggle="tab" class="text-center">Konferenz</a>
                        </li>
                    </ul>
                    <div class="tab-content" style="background:#f9f9f9">
                        <div id="popular10" class="tab-pane active">
                            {% include 'appointment/forms/infocard_form.html' %}
                        </div>

                        <div id="recent10" class="tab-pane">
                            {% include 'appointment/forms/conference_form.html' %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel-body">
        <div class="col-md-8 col-md-offset-2">
            <div id="calendar"></div>
        </div>
    </div>


    <style>
        @media only screen and (max-width: 480px) {
            .modal .modal-dialog {
                position:relative;
                width:auto;
                margin: 10px;
            }
        }

        @media only screen and (min-width: 481px) {
            .modal .modal-dialog {
                width:414px;
            }
        }
    </style>

    <!-- Modal -->
    <div id="edit_infobox" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <form method="POST" id="edit_infobox_form">{% csrf_token %}
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header" style="background-color:#f0ad4e;color:white;border-radius: 3px;">
                <button type="button" style="color:black;" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Infobox bearbeiten</h4>
              </div>
              <div class="modal-body">
                    {% include 'appointment/forms/edit_infocard_form.html' %}
              </div>
              <div class="modal-footer">
                  <div style="float:left;">
                      <button type="submit" class="btn" style="background-color:#f0ad4e;color:white;">Änderungen speichern</button>
                  </div>
              </div>
            </div>
        </form>
      </div>
    </div>


    <!-- Modal -->
    <div id="edit_conference" class="modal fade" role="dialog">
      <div class="modal-dialog">
          <form method="POST" id="edit_conference_form">{% csrf_token %}
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header" style="background-color:#428bca;color:white;border-radius: 3px;">
                <button type="button" style="color:black;" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Konferenz bearbeiten</h4>
              </div>
              <div class="modal-body">
                    {% include 'appointment/forms/edit_conference_form.html' %}
              </div>
              <div class="modal-footer">
                  <div style="float:left;">
                      <button type="submit" class="btn" style="background-color:#428bca;color:white;">Änderungen speichern</button>
                  </div>
              </div>
            </div>
          </form>
      </div>
    </div>

    <script>
        var toggle_button = document.getElementById("appointment_btn");
        var collapse_arrow = document.getElementById("collapse_arrow");

        toggle_button.onclick = function(e){
              var aria_expanded = toggle_button.getAttribute("aria-expanded");
              if(aria_expanded == "true"){
                  collapse_arrow.className = collapse_arrow.className.replace("chevron-up", "chevron-down")
              }else{
                  collapse_arrow.className = collapse_arrow.className.replace("chevron-down", "chevron-up")
              }
        };

    </script>
{% endblock %}

{% block specific_page_vendor_js %}
    <script src="{% static 'octopus/assets/vendor/pnotify/pnotify.custom.js' %}"></script>
    <script src="{% static 'octopus/assets/javascripts/ui-elements/examples.modals.js'  %}"></script>
    <script src="{% static 'octopus/assets/vendor/jquery-ui/js/jquery-ui-1.10.4.custom.js' %}"></script>
    <script src="{% static 'octopus/assets/vendor/jquery-ui-touch-punch/jquery.ui.touch-punch.js' %}"></script>
{#    <script src="{% static 'octopus/assets/vendor/fullcalendar/lib/moment.min.js' %}"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>

{#    <script src="{% static 'octopus/assets/vendor/fullcalendar/fullcalendar.js' %}"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.0.3/lang-all.js"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/locale-all.js"></script>

    <script>


// newer version fullcalendar

$(function() {

  // page is now ready, initialize the calendar...

  $('#calendar').fullCalendar({
    // put your options and callbacks here

          locale: 'de',
          themeSystem: 'bootstrap3',
          weekNumbers: true,
          eventLimit: true,
          displayEventEnd: true,
          businessHours: {
              // days of week. an array of zero-based day of week integers (0=Sunday)
              dow: [ 1, 2, 3, 4, 5], // Monday - Thursday
              start: '10:00', // a start time (10am in this example)
              end: '18:00' // an end time (6pm in this example)
            },
          nowIndicator: true,
          header: {
            left: 'prev, next today',
            center: 'title',
            right: 'month, basicWeek , agendaWeek, basicDay, agendaDay'
          },
          buttonText: {
                agendaWeek: 'Stundenplan Woche',
                agendaDay: 'Stundenplan Tag'
            },

                    // put your options and callbacks here
                        eventSources: [

                            // your event source
                            {
                              url: '{% url "appointment:appointment-calendar" %}', // use the `url` property
                              color: "#428bca",    // an option!
                              textColor: 'white',  // an option!
                              data: {
                                  is_conference: true
                              }
                            },

                            // any other sources...
                            // your event source
                            {
                              url: '{% url "appointment:appointment-calendar" %}', // use the `url` property
                              color: "#f0ad4e",    // an option!
                              textColor: 'white',  // an option!
                              type: "GET",
                              data: {
                                  is_infobox: true
                              }
                            }

                      ],
                      eventRender: function (event, element, view) {
                            element.find(".fc-event-title").remove();
                            element.find(".fc-event-time").remove();

                            var promoter_name = event.promoter_name || "";
                            var start_date = moment(event.start_date, "YYYY-MM-DD hh:mm").toDate();
                            var start_time = start_date.getHours() + ":" + start_date.getMinutes();
                            var end_date = moment(event.end_date, "YYYY-MM-DD hh:mm").toDate();
                            var end_time = end_date.getHours() + ":" + end_date.getMinutes();
                            var date = start_time + "-" + end_time + " Uhr";


                            element.append("<i>" + promoter_name + "</i>");

                            $(element).css("margin-top", "5px");
                            $(element).css("margin-bottom", "5px");
                            $(element).css("padding", "5px");
                            var description = event.description;

                            if(event.description == "" || event.description == null){
                                description = "Kein Beschreibung vorhanden";
                            }

                            var title = "<b>Thema:</b>&nbsp&nbsp;" + event.title;

                            if(event.promoter_name!= null && event.promoter_name != ""){
                                title += "<br/><b>Referent: </b>&nbsp;" + event.promoter_name
                            }



                            $(element).popover({
                                html: "true",
                                title: title,
                                content: "<p><b>Uhrzeit: " + "</b>" + date + "</p>" + description,
                                trigger: 'hover',
                                placement: 'top',
                                container: 'body'
                            });

                      },
                        eventClick:  function(event, jsEvent, view) {
                            var is_infobox = event.is_infobox;
                            var is_conference = event.is_conference;

                            var start_date = moment(event.start_date, "YYYY-MM-DD hh:mm").toDate();
                            var start_date_str = start_date.toLocaleDateString("de-DE");
                            var start_date_time = start_date.toLocaleTimeString("de-DE", {hour: '2-digit', minute:'2-digit'});

                            var end_date = moment(event.end_date, "YYYY-MM-DD hh:mm").toDate();
                            var end_date_str = end_date.toLocaleDateString("de-DE");
                            var end_date_time = end_date.toLocaleTimeString("de-DE", {hour: '2-digit', minute:'2-digit'});

                            var action_url;

                            var create_and_open_event_modal = function(){
                               if(is_infobox) {
                                    $('#edit_infobox').modal();


                                    $('#id_infobox_edit-start_date').val(start_date_str + " " + start_date_time);

                                    $('#id_infobox_edit-end_date').val(end_date_str + " " + end_date_time);
                                    $("#id_infobox_edit-topic").val(event.title);
                                    $("#id_infobox_edit-description").val(event.description);
                                    $("#id_infobox_edit-place").val(event.place);
                                    $('#id_infobox_edit-promoter').find($('option')).attr('selected',false);

                                    $("#id_infobox_edit-promoter option").each(function() {
                                      if($(this).text() == event.promoter_name) {
                                          $(this).prop('selected', true);
                                      }
                                    });

                                    action_url = "{% url 'appointment:edit_infobox' pk=0 %}";
                                    action_url = action_url.replace("0", event.pk);
                                    // die 0 ist als Platzhalt weil event.pk erst nach python im frontend ausgeführt wird
                                    $('#edit_infobox_form').attr('action', action_url);

                                }else if(is_conference){
                                    $('#edit_conference').modal();

                                    $('#id_conference_edit-start_date').val(start_date_str + " " + start_date_time);

                                    $('#id_conference_edit-end_date').val(end_date_str + " " + end_date_time);
                                    $("#id_conference_edit-topic").val(event.title);
                                    $("#id_conference_edit-description").val(event.description);
                                    $("#id_conference_edit-place").val(event.place);
                                    $('#id_conference_edit-promoter').find($('option')).attr('selected',false);

                                    $("#id_conference_edit-promoter option").each(function() {
                                      if($(this).text() == event.promoter_name) {
                                          $(this).prop('selected', true);
                                      }
                                    });

                                    action_url = "{% url 'appointment:edit_conference' pk=0 %}";
                                    action_url = action_url.replace("0", event.pk);
                                    // die 0 ist als Platzhalt weil event.pk erst nach python im frontend ausgeführt wird
                                    $('#edit_conference_form').attr('action', action_url);

                                }
                            };

                            create_and_open_event_modal();


                        }



  })

});

//

{#              $(document).ready(function(){#}
{#                    $('[data-toggle="popover"]').popover();#}
{#              });#}
{##}
{##}
{##}
{#              $(function() {#}
{##}
{#                  {% if edit_infobox_form.errors %}#}
{#                    $("#edit_infobox").modal();#}
{#                  {% endif %}#}
{##}
{#                  // page is now ready, initialize the calendar...#}
{#                  $('#calendar').fullCalendar({#}
{#                        lang: "de",#}
{#                        displayEventEnd: true,#}
{#                        nextDayThreshold:'00:00:00',#}
{#                        eventOrder: ["title", "start_date", "end_date"],#}
{#                        header: {#}
{#                            left: 'prev, next today',#}
{#                            center: 'title',#}
{#                            right: 'month, basicWeek , basicDay'#}
{#                        },#}
{##}
{#                    // put your options and callbacks here#}
{#                        eventSources: [#}
{##}
{#                            // your event source#}
{#                            {#}
{#                              url: '{% url "appointment:appointment-calendar" %}', // use the `url` property#}
{#                              color: "#428bca",    // an option!#}
{#                              textColor: 'white',  // an option!#}
{#                              data: {#}
{#                                  is_conference: true#}
{#                              }#}
{#                            },#}
{##}
{#                            // any other sources...#}
{#                            // your event source#}
{#                            {#}
{#                              url: '{% url "appointment:appointment-calendar" %}', // use the `url` property#}
{#                              color: "#f0ad4e",    // an option!#}
{#                              textColor: 'white',  // an option!#}
{#                              data: {#}
{#                                  is_infobox: true#}
{#                              }#}
{#                            }#}
{##}
{#                      ],#}
{#                      eventRender: function (event, element, view) {#}
{#                            element.find(".fc-event-title").remove();#}
{#                            element.find(".fc-event-time").remove();#}
{##}
{#                            var promoter_name = event.promoter_name || "";#}
{#                            var start_date = moment(event.start_date, "YYYY-MM-DD hh:mm").toDate();#}
{#                            var start_time = start_date.getHours() + ":" + start_date.getMinutes();#}
{#                            var end_date = moment(event.end_date, "YYYY-MM-DD hh:mm").toDate();#}
{#                            var end_time = end_date.getHours() + ":" + end_date.getMinutes();#}
{#                            var date = start_time + "-" + end_time + " Uhr";#}
{#                            var title = event.title || "";#}
{#                            var html_element = '<a style="color:white;cursor:pointer;"><span class="fa fa-pencil" style="float:right;"></span></a>';#}
{#                            html_element +=  '<span class="fc-event-title">' + title +'</span><br/>';#}
{#                            if(promoter_name) {#}
{#                                html_element += '<span class="fc-event-title"><i> ' + promoter_name + '</i></span><br/>';#}
{#                            }#}
{#                            html_element += '<span class="fc-event-title" style="font-weight:bold;"> ' + date +'</span><br/>';#}
{#                            var parent = '<div class="fc-event-inner">' + html_element + '</div>';#}
{#                            element.append(parent);#}
{##}
{#                            var description = event.description;#}
{##}
{#                            if(event.description == "" || event.description == null){#}
{#                                description = "Kein Beschreibung vorhanden";#}
{#                            }#}
{##}
{#                            title = "<b>Thema:</b>&nbsp&nbsp;" + event.title;#}
{##}
{#                            if(event.promoter_name!= null && event.promoter_name != ""){#}
{#                                title += "<br/><b>Referent: </b>&nbsp;" + event.promoter_name#}
{#                            }#}
{##}
{##}
{##}
{#                            $(element).popover({#}
{#                                html: "true",#}
{#                                title: title,#}
{#                                content: "<p><b>Uhrzeit: " + "</b>" + date + "</p>" + description,#}
{#                                trigger: 'hover',#}
{#                                placement: 'top',#}
{#                                container: 'body'#}
{#                            });#}
{##}
{#                      },#}
{#                        eventClick:  function(event, jsEvent, view) {#}
{#                            var is_infobox = event.source.data.is_infobox;#}
{#                            var is_conference = event.source.data.is_conference;#}
{##}
{#                            var start_date = moment(event.start_date, "YYYY-MM-DD hh:mm").toDate();#}
{#                            var start_date_str = start_date.toLocaleDateString("de-DE");#}
{#                            var start_date_time = start_date.toLocaleTimeString("de-DE", {hour: '2-digit', minute:'2-digit'});#}
{##}
{#                            var end_date = moment(event.end_date, "YYYY-MM-DD hh:mm").toDate();#}
{#                            var end_date_str = end_date.toLocaleDateString("de-DE");#}
{#                            var end_date_time = end_date.toLocaleTimeString("de-DE", {hour: '2-digit', minute:'2-digit'});#}
{##}
{#                            var action_url;#}
{##}
{#                            var create_and_open_event_modal = function(){#}
{#                               if(is_infobox) {#}
{#                                    $('#edit_infobox').modal();#}
{##}
{##}
{#                                    $('#id_infobox_edit-start_date').val(start_date_str + " " + start_date_time);#}
{##}
{#                                    $('#id_infobox_edit-end_date').val(end_date_str + " " + end_date_time);#}
{#                                    $("#id_infobox_edit-topic").val(event.title);#}
{#                                    $("#id_infobox_edit-description").val(event.description);#}
{#                                    $("#id_infobox_edit-place").val(event.place);#}
{#                                    $('#id_infobox_edit-promoter').find($('option')).attr('selected',false);#}
{##}
{#                                    $("#id_infobox_edit-promoter option").each(function() {#}
{#                                      if($(this).text() == event.promoter_name) {#}
{#                                          $(this).prop('selected', true);#}
{#                                      }#}
{#                                    });#}
{##}
{#                                    action_url = "{% url 'appointment:edit_infobox' pk=0 %}";#}
{#                                    action_url = action_url.replace("0", event.pk);#}
{#                                    // die 0 ist als Platzhalt weil event.pk erst nach python im frontend ausgeführt wird#}
{#                                    $('#edit_infobox_form').attr('action', action_url);#}
{##}
{#                                }else if(is_conference){#}
{#                                    $('#edit_conference').modal();#}
{##}
{#                                    $('#id_conference_edit-start_date').val(start_date_str + " " + start_date_time);#}
{##}
{#                                    $('#id_conference_edit-end_date').val(end_date_str + " " + end_date_time);#}
{#                                    $("#id_conference_edit-topic").val(event.title);#}
{#                                    $("#id_conference_edit-description").val(event.description);#}
{#                                    $("#id_conference_edit-place").val(event.place);#}
{#                                    $('#id_conference_edit-promoter').find($('option')).attr('selected',false);#}
{##}
{#                                    $("#id_conference_edit-promoter option").each(function() {#}
{#                                      if($(this).text() == event.promoter_name) {#}
{#                                          $(this).prop('selected', true);#}
{#                                      }#}
{#                                    });#}
{##}
{#                                    action_url = "{% url 'appointment:edit_conference' pk=0 %}";#}
{#                                    action_url = action_url.replace("0", event.pk);#}
{#                                    // die 0 ist als Platzhalt weil event.pk erst nach python im frontend ausgeführt wird#}
{#                                    $('#edit_conference_form').attr('action', action_url);#}
{##}
{#                                }#}
{#                            };#}
{##}
{#                            create_and_open_event_modal();#}
{##}
{##}
{#                        }#}
{##}
{#                    }#}
{##}
{#              );#}
{#        });#}

      $(function () {
            $('.datetimepicker').datetimepicker(
                {
                    locale: 'de',
                    widgetPositioning:{
                        horizontal: 'auto',
                        vertical: 'bottom'
                    }
                }
            );
      });

    </script>

{% endblock %}


{% block specific_page_vendor_css %}
    <link rel="stylesheet" href="{% static 'octopus/assets/vendor/pnotify/pnotify.custom.css'  %}" />
    <link rel="stylesheet" href="{% static 'octopus/assets/vendor/jquery-ui/css/ui-lightness/jquery-ui-1.10.4.custom.css'  %}" />
{#    <link rel="stylesheet" href="{% static 'octopus/assets/vendor/fullcalendar/fullcalendar.css'  %}" />#}
{#    <link rel="stylesheet" href="{% static 'octopus/assets/vendor/fullcalendar/fullcalendar.print.css' %}" media='print'  />#}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.print.css" media='print'  />


    <style>
    .fc-event-inner {
       white-space: normal;
       text-overflow: ellipsis;

    }


    </style>
{% endblock %}